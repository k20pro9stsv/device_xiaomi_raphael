#Mad--------------------------------------------------
on early-init
    # ZRAM setup
    write /sys/block/zram0/comp_algorithm lz4
    write /sys/block/zram0/max_comp_streams 8
    write /proc/sys/vm/page-cluster 0
#Mad--------------------------------------------------

on init
    mount none /system/lib/modules/wlan.ko /vendor/lib/modules/qca_cld3_wlan.ko bind
    mount none /sbin/chargeonlymode /sbin/charger bind
    mount none /system/bin/hw/android.hardware.power@1.2-service /vendor/bin/hw/android.hardware.power@1.2-service bind
    mount none /system/lib64/soundfx/libvolumelistener.so /vendor/lib64/soundfx/libvolumelistener.so bind
    mount none /system/lib/soundfx/libvolumelistener.so /vendor/lib/soundfx/libvolumelistener.so bind
    mount none /system/overlay/BluetoothResCommon.apk /vendor/overlay/BluetoothResCommon.apk bind

    mount none /system/etc/audio_policy_configuration.xml /vendor/etc/audio/audio_policy_configuration.xml bind
    mount none /system/etc/audio_effects.xml /vendor/etc/audio_effects.xml bind
    mount none /system/etc/media_codecs.xml /vendor/etc/media_codecs.xml bind

    chown system system /dev/input/event3
    chmod 0666 /dev/input/event3

service vendor.motor /vendor/bin/hw/vendor.xiaomi.hardware.motor@1.0-service
    class hal
    user system
    group system
    disabled
 
    # Boot time FS tune
    write /sys/block/sda/queue/iostats 0
    write /sys/block/sda/queue/scheduler cfq
    write /sys/block/sda/queue/iosched/slice_idle 0
    write /sys/block/sda/queue/read_ahead_kb 2048
    write /sys/block/sda/queue/nr_requests 256
    write /sys/block/sdf/queue/iostats 0
    write /sys/block/sdf/queue/scheduler cfq
    write /sys/block/sdf/queue/iosched/slice_idle 0
    write /sys/block/sdf/queue/read_ahead_kb 2048
    write /sys/block/sdf/queue/nr_requests 256
    write /sys/block/dm-0/queue/read_ahead_kb 2048
    write /sys/block/dm-1/queue/read_ahead_kb 2048
    write /sys/block/dm-2/queue/read_ahead_kb 2048

on late-fs
    # Boot time FS tune
    write /sys/block/dm-3/queue/read_ahead_kb 2048

service vendor.ss_ramdump_local /vendor/bin/subsystem_ramdump
    class late_start
    user system
    group system
    disabled

on property init.svc.vendor.motor=running
    stop vendor.motor

on property:sys.boot_completed=1
    swapon_all /system/vendor/etc/fstab.qcom
    write /sys/block/zram0/comp_algorithm lz4
    write /proc/sys/vm/page-cluster 0

on property:persist.vendor.sys.ssr.enable_ramdumps=1
    start vendor.ss_ramdump_local

on property:persist.vendor.sys.ssr.enable_ramdumps=0
    stop vendor.ss_ramdump
    stop vendor.ss_ramdump_local

on property:sys.boot_completed=1
    stop vendor.ss_ramdump

    # Runtime FS tuning: as we have init boottime setting and kernel patch setting
    # default readahead to 2048KB. We should adjust the setting upon boot_complete
    # for runtime performance
    write /sys/block/sda/queue/read_ahead_kb 128
    write /sys/block/sda/queue/nr_requests 128
    write /sys/block/sda/queue/iostats 1
    write /sys/block/sdf/queue/read_ahead_kb 128
    write /sys/block/sdf/queue/nr_requests 128
    write /sys/block/sdf/queue/iostats 1
    write /sys/block/dm-0/queue/read_ahead_kb 128
    write /sys/block/dm-1/queue/read_ahead_kb 128
    write /sys/block/dm-2/queue/read_ahead_kb 128
    write /sys/block/dm-3/queue/read_ahead_kb 128

    #Mad--------------------------------------------------------------------
    # TCP 
    write /proc/sys/net/ipv4/tcp_congestion_control cubic

    # LMK
    write /sys/module/lowmemorykiller/parameters/minfree "18432,23040,27648,32256,36864,46080"

    # I/O Scheduler
    setprop sys.io.scheduler anxiety
    write /sys/block/mmcblk0/queue/scheduler anxiety
    write /sys/block/mmcblk0rpmb/queue/scheduler anxiety

    # Adreno Idler
    write /sys/module/adreno_idler/parameters/adreno_idler_idleworkload 6000
    write /sys/module/adreno_idler/parameters/adreno_idler_idlewait 18
    write /sys/module/adreno_idler/parameters/adreno_idler_downdiffrential 24

    # Set initial GPU freq
    write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 6

    # Disable sched_boost
    echo "0" > /proc/sys/kernel/sched_boost

    # Set default schedTune value for foreground/top-app
    echo "0" > /dev/stune/top-app/schedtune.boost

    # Dynamic Stune Boost during sched_boost
    echo "10" > /dev/stune/top-app/schedtune.sched_boost

    # Set default schedTune value for foreground/top-app
    echo "1" > /dev/stune/foreground/schedtune.prefer_idle
    echo "1" > /dev/stune/top-app/schedtune.prefer_idle

    # Configure governor settings for little cluster
    echo "schedutil" > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    echo "1000" > /sys/devices/system/cpu/cpu0/cpufreq/schedutil/up_rate_limit_us
    echo "10000" > /sys/devices/system/cpu/cpu0/cpufreq/schedutil/down_rate_limit_us
    echo "0" > /sys/devices/system/cpu/cpu0/cpufreq/schedutil/iowait_boost_enable

    # Configure governor settings for big cluster
    echo "schedutil" > /sys/devices/system/cpu/cpu6/cpufreq/scaling_governor
    echo "2000" > /sys/devices/system/cpu/cpu6/cpufreq/schedutil/up_rate_limit_us
    echo "10000" > /sys/devices/system/cpu/cpu6/cpufreq/schedutil/down_rate_limit_us
    echo "0" > /sys/devices/system/cpu/cpu6/cpufreq/schedutil/iowait_boost_enable

    # Configure governor settings for Prime cluster
    echo "schedutil" > /sys/devices/system/cpu/cpu7/cpufreq/scaling_governor
    echo "3000" > /sys/devices/system/cpu/cpu7/cpufreq/schedutil/up_rate_limit_us
    echo "10000" > /sys/devices/system/cpu/cpu7/cpufreq/schedutil/down_rate_limit_us
    echo "0" > /sys/devices/system/cpu/cpu7/cpufreq/schedutil/iowait_boost_enable

    # Input boost configuration
    echo "1" > /sys/module/cpu_boost/parameters/input_boost_enabled
    echo "0:844800 6:691200" > /sys/module/cpu_boost/parameters/input_boost_freq
    echo "80" > /sys/module/cpu_boost/parameters/input_boost_ms
    #Mad-------------------------------------------------------
